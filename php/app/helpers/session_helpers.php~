<?php

const BASE_URL = '/isFor-website/public/index.php';
const SESSION_TIMEOUT = 1800; // 30 menit

// Fungsi-fungsi lainnya di sini...

/**
 * Memulai session jika belum dimulai.
 */
function initSession(): void
{
    if (session_status() == PHP_SESSION_NONE) {
        session_start();
    }
}

/**
 * Mengalihkan ke halaman login jika pengguna belum login.
 */
function redirectIfNotLoggedIn(): void
{
    initSession(); // Pastikan session aktif

    if (!isset($_SESSION['user_id'])) {
        header("Location: " . BASE_URL . "?page=login");
        exit();
    }
}

/**
 * Mengalihkan ke halaman login jika pengguna bukan admin.
 */
function redirectIfNotAdmin(): void
{
    initSession(); // Pastikan session aktif

    if (!isset($_SESSION['user_id']) || $_SESSION['role_id'] != 1) {
        header("Location: " . BASE_URL . "?page=login");
        exit();
    }
}

function checkSessionTimeout(): void
{
    if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > SESSION_TIMEOUT)) {
        // Hapus session dan arahkan ke login
        session_unset();
        session_destroy();
        header("Location: " . BASE_URL . "?page=login");
        exit();
    }
    $_SESSION['LAST_ACTIVITY'] = time(); // Perbarui waktu aktivitas terakhir
}
